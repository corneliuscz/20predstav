<html>
  <head>
    <title>Hlasujte pro nejlepší představu</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link href="style.css" rel="stylesheet">
  </head>

  <body>
    <div id="header">
      <div class="header-content">
        <div class="bublina-kontejner">
          <p class="bublina">Klikni a hlasuj <br>pro nejzajímavější představu jedné z hvězdných osobností našeho kraje.</p>
        </div>
      </div>
    </div>
    <div id="predstavy">
      <div class="col" id="birklen">
        <a href="#" data-key="birklen"> <img src="img/bublina-birklen.png" width="105" height="113"></a>
        <div class="jmeno">Petr<br>Birklen</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="cienciala">
        <a href="#" data-key="cienciala"> <img src="img/bublina-cienciala.png" width="105" height="113"></a>
        <div class="jmeno">Jiří<br>Cienciala</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="filipkova">
        <a href="#" data-key="filipkova"> <img src="img/bublina-filipkova.png" width="105" height="113"></a>
        <div class="jmeno">Zuzana<br>Filipková</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="klimek">
        <a href="#" data-key="klimek"> <img src="img/bublina-klimek.png" width="105" height="113"></a>
        <div class="jmeno">Petr<br>Klimek</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="kotik">
        <a href="#" data-key="kotik"> <img src="img/bublina-kotik.png" width="105" height="113"></a>
        <div class="jmeno">Petr<br>Kotík</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="lobkowicz">
        <a href="#" data-key="lobkowicz"> <img src="img/bublina-lobkowicz.png" width="105" height="113"></a>
        <div class="jmeno">František<br>Lobkowicz</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="lukasik">
        <a href="#" data-key="lukasik"> <img src="img/bublina-lukasik.png" width="105" height="113"></a>
        <div class="jmeno">Petr<br>Lukasík</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="rumpel">
        <a href="#" data-key="rumpel"> <img src="img/bublina-rumpel.png" width="105" height="113"></a>
        <div class="jmeno">Petr<br>Rumpel</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="sventek">
        <a href="#" data-key="sventek"> <img src="img/bublina-sventek.png" width="105" height="113"></a>
        <div class="jmeno">David<br>Sventek</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="svetlik">
        <a href="#" data-key="svetlik"> <img src="img/bublina-svetlik.png" width="105" height="113"></a>
        <div class="jmeno">Jan<br>Světlík</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="silerova">
        <a href="#" data-key="silerova"> <img src="img/bublina-silerova.png" width="105" height="113"></a>
        <div class="jmeno">Jana<br>Šilerová</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="simcik">
        <a href="#" data-key="simcik"> <img src="img/bublina-simcik.png" width="105" height="113"></a>
        <div class="jmeno">Antonín<br>Šimčík</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="simicek">
        <a href="#" data-key="simicek"> <img src="img/bublina-simicek.png" width="105" height="113"></a>
        <div class="jmeno">Petr<br>Šimíček</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="vondrak">
        <a href="#" data-key="vondrak"> <img src="img/bublina-vondrak.png" width="105" height="113"></a>
        <div class="jmeno">Ivo<br>Vondrák</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
      <div class="col" id="weimann">
        <a href="#" data-key="weimann"> <img src="img/bublina-weimann.png" width="105" height="113"></a>
        <div class="jmeno">Jakub<br>Weimann</div>
        <div class="sloupec"></div>
        <div class="hlasy"></div>
      </div>
    </div>
    <div id="footer">
        <h1 class="logo"><img src="img/logo.svg" width="355" height="100"></h1>
        <p class="oprojektu">Odvážné myšlenky a dříve nevyřčené představy osobností a odborníků o&nbsp;naší budoucnosti a životě v&nbsp;Moravskoslezském kraji. Jak by měl kraj vypadat v&nbsp;roce 2020? A jak k&nbsp;tomu mohou pomoci peníze z&nbsp;evropských fondů?</p>
      <img src="img/publicita.png" width="374" height="75" alt="Publicita">
    </div>
  </body>

  <script src="json2.js"></script>
  <script src="jquery-1.11.1.min.js"></script>
  <script src="jstorage.js"></script>
  <script>
    $(function () {
      "use strict";

      var predstavy = [ 'birklen',
                       'cienciala',
                       'filipkova',
                       'klimek',
                       'kotik',
                       'lobkowicz',
                       'lukasik',
                       'rumpel',
                       'sventek',
                       'svetlik',
                       'silerova',
                       'simcik',
                       'simicek',
                       'vondrak',
                       'weimann' ],
          tempValue = 0,
          value     = 0,
          id        = 0,
          jmeno     = "",
          min       = 100000,
          max       = -100000,
          celkem    = 0,
          procento  = 0,
          data      = [],
          maxvyska  = 475;

  /*
   *  Inicializace hodnot
   */
      $.each (predstavy, function(id, jmeno){
        data[jmeno] = $.jStorage.get(jmeno);

        if(!data[jmeno]) {
          $.jStorage.set(jmeno, value);
        }
        else {
          $('#'+ jmeno +' > .hlasy').text( data[jmeno] );
        }
      });

      for (var klic in data){
        celkem = celkem + data[klic];
      }

      if (celkem != 0) {
        for (var key in data){
          procento = Math.round ( (data[key] / celkem ) * maxvyska );

          if (procento != 0 ) {
            $('#'+key+' > .sloupec').animate({ height: procento+"px" }, 500);
          }
        }
      }
      //$.jStorage.flush();

      $('div.col').on('click', '[data-key]', function () {

        var autor = $(this).attr('data-key'),
            timer = '<div class="timer"><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" version="1.1" width="64" height="64"><path d="M 32 5 A 27 27 0 0 1 32 59 27 27 0 1 1 32 5 z" class="kruh"/></svg><div class="counter">6</div></div>',
            puvodni = "<a href='#' data-key=" + autor + "> <img src='img/bublina-" + autor + ".png' width='105' height='113'></a>";

        tempValue = $.jStorage.get( autor );
        tempValue++;

        $.jStorage.set( autor, tempValue);
        $('#'+autor+' > .hlasy').text( tempValue );
        data[ autor ] = tempValue;

        $('div#'+ autor + ' a').remove()

        $('div#'+ autor).prepend(timer);
        $({countNum: $('div#'+ autor + ' .counter').text()}).animate({countNum: 1}, {
          duration: 5000,
          easing:'linear',
          step: function() {
            $('div#'+ autor + ' .counter').text(Math.floor(this.countNum));
          },
          complete: function() {
            $('div#'+ autor +' div.timer').remove();
            $('div#'+ autor).prepend(puvodni);
          }
        });

        celkem = 0;

        for (var klic in data){
          celkem = celkem + data[klic];
        }

        for (var key in data){
          procento = Math.round ( (data[key] / celkem ) * maxvyska );

          if (procento != 0 ) {
            $('#'+key+' > .sloupec').animate({ height: procento+"px" }, 500);
          }
        }

      });
    });

  </script>
</html>
